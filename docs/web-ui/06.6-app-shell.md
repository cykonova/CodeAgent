# Phase 06.6: App Shell

## Overview
Implement the main application shell that serves as the container for all features, including the layout structure, header, and content area.

## Objectives
- Create responsive application layout
- Implement collapsible sidenav
- Add header with user menu
- Set up router outlet for feature modules
- Implement theme toggle

## Prerequisites
- Phase 06.1 (Project Setup) completed
- Phase 06.2 (Theme System) completed
- Phase 06.3 (Site Layout) completed

## Implementation

### 1. App Component Requirements

#### Component Architecture
Configure the main application component with:
- Standalone component using Angular Material modules
- Import necessary layout, navigation, and menu modules
- Integrate ThemeService for theme management
- Connect WebSocketService for status monitoring
- Use BreakpointObserver for responsive behavior

#### Template Structure
Build the application shell with these components:

**Sidenav Container:**
- Use Material sidenav container as root element
- Apply dark theme class conditionally
- Full viewport height layout

**Side Navigation:**
- Configure Material sidenav with:
  - Responsive mode (side/over) based on screen size
  - Dynamic open/closed state
  - Fixed positioning with top gap for toolbar
  - Width of 250px, collapsible to 64px
- Embed NavigationMenuComponent with collapse state
- Handle item click events for mobile navigation

**Header Toolbar:**
- Material toolbar with primary color theme
- Include menu toggle button with icon
- Display application title
- Show WebSocket connection status indicator
- Add notification button with badge count
- Include theme toggle button
- Add user menu button
- Use flexbox spacer for alignment

**Content Area:**
- Main element with router outlet
- Apply padding using `--spacing-lg` variable
- Responsive margin adjustment for sidenav
- Minimum height calculation

**Notification Menu:**
- Material menu component for notifications
- Display notification items with icons and messages
- Color-code by notification type
- Include "View all" action
- Empty state message when no notifications

**User Menu:**
- Material menu with user information display
- Show user avatar with initials or icon
- Display user name and email
- Include navigation items for profile and settings
- Add logout action

#### Component Logic

**Properties to Implement:** 
- Sidenav reference using ViewChild
- Observable for sidenav open state
- Observable for sidenav mode (side/over/push)
- Boolean for collapsed state
- Observable for dark theme state from ThemeService
- Observable for WebSocket connection status
- Computed observables for connection icon and CSS class
- Notification count and array
- User information (name, email)

**Methods to Implement:**
- `ngOnInit()`: Initialize responsive sidenav setup
- `setupResponsiveSidenav()`: Configure breakpoint observer for responsive behavior
- `toggleSidenav()`: Handle sidenav toggle with collapse/expand logic
- `onNavItemClick()`: Close sidenav on mobile after navigation
- `toggleTheme()`: Call ThemeService to toggle theme
- `viewAllNotifications()`: Navigate to notifications page
- `logout()`: Implement logout logic

**Responsive Behavior:**
- Use BreakpointObserver to detect screen size
- Switch sidenav mode between 'side' and 'over' at 768px breakpoint
- Auto-close sidenav on mobile screens
- Adjust toolbar elements for mobile display

### 2. App Component Styling Guidelines

#### Container Layout
- Set app container to full viewport height
- Configure smooth transitions for layout changes

#### Sidenav Styling
- Default width: 250px
- Collapsed width: 64px
- Transition: Use CSS transition for smooth width changes
- Apply theme variables for spacing

#### Toolbar Styling
- Position: Sticky at top with z-index for layering
- Shadow: Apply `--shadow-sm` variable
- Title styling:
  - Margin: Use `--spacing-sm` variable
  - Font: Use Material typography scale
  - Weight: Use `--font-weight-medium` variable

#### Connection Status Indicator
- Layout: Flexbox with center alignment
- Gap: Use `--spacing-xs` variable
- Margin: Use `--spacing-lg` variable
- Padding: Use `--spacing-xs` and `--spacing-sm` variables
- Border radius: Use `--radius-sm` variable
- Font size: Use Material caption size

Status color states:
- **Connected**: Material success color with low opacity background
- **Connecting**: Material warning color with rotation animation
- **Disconnected**: Material error color with low opacity background

#### Content Area
- Padding: Use `--spacing-lg` variable
- Min height: Calculate based on viewport minus toolbar
- Background: Use Material surface color
- Transition: Smooth margin adjustment for sidenav

#### Menu Styling

**Notification Menu:**
- Max width: 350px for readability
- Item padding: Use `--spacing-sm` and `--spacing-md` variables
- Icon margin: Use `--spacing-md` variable
- Auto height for multi-line content

**User Menu:**
- Info section padding: Use `--spacing-md` variable
- Avatar dimensions: 48x48px
- Avatar border radius: Use `--radius-full` (50%)
- Avatar background: Use primary color from theme
- User details typography: Use Material text styles
- Email color: Use Material secondary text opacity

#### Animations
- Define spin keyframe for loading states
- Smooth rotation from 0 to 360 degrees

#### Dark Theme Adjustments
- Content background: Use Material dark surface color
- Text colors: Adjust opacity for dark backgrounds
- Ensure sufficient contrast for all elements

#### Responsive Design
- Breakpoint at 768px for mobile
- Reduce title font size on mobile
- Hide connection status text (show icon only)
- Adjust padding and spacing for smaller screens

### 3. App Initialization

Configure the application bootstrap process:
- Use bootstrapApplication from Angular platform browser
- Load AppComponent with appConfig
- After successful initialization:
  - Log initialization message
  - Remove loading spinner with fade animation
  - Clean up DOM after animation completes
- Handle bootstrap errors appropriately

### 4. Loading Screen Configuration

Set up the initial loading experience in index.html:

**HTML Structure:**
- Configure viewport for responsive design
- Load Material Icons and Roboto font from Google Fonts
- Include favicon and base href
- Add app-root element with loading content

**Loading Spinner Styles:**
- Full screen overlay with fixed positioning
- Centered flexbox layout
- High z-index to cover all content
- CSS spinner with:
  - 50x50px dimensions
  - Border styling using primary color
  - Rotation animation
  - Fade-out transition class

**Animation Requirements:**
- Spin animation using CSS keyframes
- Smooth fade-out transition (0.3s)
- Remove from DOM after fade completes

## Testing

### Unit Test Requirements

Create comprehensive tests for the app shell:

**Test Setup:**
- Mock ThemeService with toggleTheme method
- Mock WebSocketService with connectionState$ observable
- Configure TestBed with component and mocked services
- Create component fixture for testing

**Test Cases:**
- Component creation and initialization
- Theme toggle button functionality
- Connection status display and updates
- Sidenav toggle behavior
- Responsive mode switching
- Menu interactions (notifications, user)
- Navigation item clicks
- Logout functionality

**DOM Testing:**
- Verify toolbar elements present
- Check sidenav visibility and mode
- Confirm menus trigger correctly
- Validate theme class application
- Test responsive breakpoint changes

### Manual Testing Checklist
- [ ] App loads with loading spinner
- [ ] Loading spinner fades out after initialization
- [ ] Sidenav toggles between expanded/collapsed
- [ ] Theme toggle switches between light/dark
- [ ] Connection status updates correctly
- [ ] Notification badge displays count
- [ ] User menu shows profile information
- [ ] All theme variables applied correctly
- [ ] Responsive behavior at 768px breakpoint
- [ ] Navigation closes on mobile after selection
- [ ] No hardcoded colors or spacing

## Deliverables
- [ ] App shell with responsive layout
- [ ] Collapsible sidenav implemented
- [ ] Header with user menu functional
- [ ] Theme toggle working
- [ ] Connection status indicator
- [ ] Notification menu
- [ ] User profile menu
- [ ] Loading screen
- [ ] Responsive design for mobile
- [ ] Unit tests passing

## Next Steps
- Complete Navigation Menu (06.25)
- Implement feature pages