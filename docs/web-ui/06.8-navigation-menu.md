# Phase 06.8: Navigation Menu Component

## Overview
Create a reusable navigation menu component for the application sidenav that provides hierarchical navigation with collapsible sections, active route highlighting, and responsive behavior.

## Objectives
- Build hierarchical navigation menu
- Support expandable/collapsible sections
- Highlight active routes
- Display notification badges
- Support icon and text modes

## Prerequisites
- Phase 06.1 (Project Setup) completed
- Phase 06.2 (Theme System) completed
- Phase 06.3 (Site Layout) completed
- Angular Material installed

## Implementation

### 1. Generate Component
Use Angular CLI to generate a standalone navigation-menu component in the shared components directory.

### 2. Navigation Model Requirements

#### MenuItem Interface
Define the structure for navigation items:
- `label`: Display text for the menu item
- `icon`: Material icon name
- `route`: Router path for navigation
- `badge` (optional): Badge count or label
- `badgeColor` (optional): Material theme color for badge
- `children` (optional): Array of child MenuItem objects
- `expanded` (optional): Whether section is expanded
- `disabled` (optional): Whether item is disabled
- `permissions` (optional): Required permissions array

#### MenuSection Interface
Define menu section groupings:
- `title`: Section header text
- `items`: Array of MenuItem objects
- `collapsible`: Whether section can be collapsed
- `defaultExpanded`: Initial expanded state

### 3. Navigation Menu Component Requirements

#### Component Configuration
Create a standalone component with:
- Import Angular Material modules (List, Icon, Badge, Ripple, Expansion)
- Import Router and RouterLink directives
- Implement OnInit and OnDestroy lifecycle hooks
- Support both full and collapsed navigation modes

#### Input Properties
The component should accept:
- `menuItems`: Array of MenuSection objects
- `collapsed`: Boolean for collapsed state
- `showIcons`: Boolean to show/hide icons
- `showBadges`: Boolean to show/hide badges
- `allowNesting`: Boolean to enable nested menus
- `autoCollapse`: Boolean to auto-collapse inactive sections

#### Output Events
- `itemClick`: Emits when menu item is clicked
- `sectionToggle`: Emits when section is expanded/collapsed

#### Template Structure
Build the navigation menu with:

**Menu Sections:**
- Use Material list for structure
- Section headers with optional collapse toggle
- Dividers between sections using Material divider

**Menu Items:**
- Material list items with ripple effect
- Icon display with consistent sizing
- Text labels with proper typography
- Badge display for counts/status
- Nested items with indentation

**Active State:**
- Highlight active route with primary color background
- Bold text for active items
- Show active indicator bar
- Maintain active state during navigation

**Collapsed Mode:**
- Show only icons in collapsed state
- Display tooltips with full labels
- Hide section headers
- Reduce padding and width

### 4. Navigation Menu Styling Guidelines

#### Layout Styles
- Full width of sidenav container
- Smooth transitions for all state changes
- Proper spacing using theme variables

#### List Item Styles
- Padding: Use `--spacing-sm` vertical, `--spacing-md` horizontal
- Height: 48px for standard items
- Hover background: Use low opacity primary color
- Active background: Use primary color with 12% opacity
- Transition: 200ms ease for all properties

#### Icon Styles
- Size: 24px consistent sizing
- Margin: Use `--spacing-md` from text
- Color: Inherit from parent
- Active color: Primary theme color

#### Text Styles
- Font: Use Material body-1 typography
- Color: Use Material text colors with proper opacity
- Active font weight: Use `--font-weight-medium`
- Truncate with ellipsis for long labels

#### Badge Styles
- Position: Absolute right alignment
- Padding: Use `--spacing-xs` horizontal
- Border radius: Use `--radius-full` for circular badges
- Font size: Use Material caption size
- Background: Use theme colors based on badgeColor

#### Nested Items
- Indentation: Add 16px per nesting level
- Maximum nesting: 3 levels deep
- Visual hierarchy through indentation
- Slightly reduced font size for nested items

#### Collapsed Mode Styles
- Width: 64px when collapsed
- Center align icons
- Hide text labels
- Show Material tooltips on hover
- Remove section headers
- Adjust padding to center icons

#### Active Indicator
- Width: 3px vertical bar
- Position: Left edge of item
- Color: Primary theme color
- Height: Full item height
- Transition: Smooth appearance

#### Dark Theme Support
- Adjust hover backgrounds for dark surfaces
- Ensure proper contrast for all states
- Update divider colors
- Maintain readability in both themes

### 5. Component Logic

#### Route Management
- Subscribe to router events for active route detection
- Update active item on route changes
- Handle nested route matching
- Support exact and partial matching

#### Section Management
- Track expanded/collapsed state per section
- Implement auto-collapse for accordion behavior
- Persist section states in service/localStorage
- Handle programmatic expand/collapse

#### Permission Handling
- Filter menu items based on user permissions
- Hide or disable restricted items
- Update dynamically when permissions change
- Show appropriate messaging for restricted items

#### Responsive Behavior
- Adapt to sidenav collapsed state
- Handle touch events on mobile
- Support keyboard navigation
- Ensure accessibility compliance

### 6. Menu Configuration

#### Default Menu Structure
```typescript
const defaultMenu: MenuSection[] = [
  {
    title: 'Main',
    items: [
      { label: 'Dashboard', icon: 'dashboard', route: '/dashboard' },
      { label: 'Projects', icon: 'folder', route: '/projects', badge: '5' }
    ]
  },
  {
    title: 'Management',
    collapsible: true,
    items: [
      { 
        label: 'Agents', 
        icon: 'smart_toy', 
        route: '/agents',
        children: [
          { label: 'Running', route: '/agents/running', badge: '3', badgeColor: 'primary' },
          { label: 'Types', route: '/agents/types' },
          { label: 'Logs', route: '/agents/logs' }
        ]
      },
      { label: 'Providers', icon: 'dns', route: '/providers' }
    ]
  },
  {
    title: 'Settings',
    items: [
      { label: 'Profile', icon: 'person', route: '/settings/profile' },
      { label: 'Preferences', icon: 'settings', route: '/settings/preferences' }
    ]
  }
];
```

## Usage Example

```html
<app-navigation-menu
  [menuItems]="menuSections"
  [collapsed]="sidenavCollapsed"
  [showBadges]="true"
  [autoCollapse]="true"
  (itemClick)="onMenuItemClick($event)">
</app-navigation-menu>
```

```typescript
export class AppShellComponent {
  menuSections = defaultMenu;
  sidenavCollapsed = false;
  
  onMenuItemClick(item: MenuItem) {
    if (item.route) {
      this.router.navigate([item.route]);
      
      // Close sidenav on mobile after navigation
      if (this.isMobile) {
        this.sidenav.close();
      }
    }
  }
}
```

## Testing

### Unit Test Requirements
Create comprehensive tests verifying:
- Component initialization with menu data
- Active route highlighting
- Section expand/collapse functionality
- Badge display and updates
- Permission-based filtering
- Collapsed mode behavior
- Navigation triggering
- Keyboard navigation
- Event emissions

### Manual Testing Checklist
- [ ] Menu renders with all sections
- [ ] Icons display correctly
- [ ] Active route is highlighted
- [ ] Sections expand/collapse smoothly
- [ ] Badges show with correct colors
- [ ] Collapsed mode shows only icons
- [ ] Tooltips appear in collapsed mode
- [ ] Nested items indent properly
- [ ] Theme variables used throughout
- [ ] Dark theme displays correctly
- [ ] Responsive on mobile devices
- [ ] Keyboard navigation works
- [ ] Screen reader friendly

## Accessibility

### ARIA Support
- Proper role attributes for navigation
- ARIA-expanded for collapsible sections
- ARIA-current for active item
- ARIA-label for icon-only items
- Live regions for badge updates

### Keyboard Navigation
- Tab through menu items
- Enter/Space to activate items
- Arrow keys for navigation
- Escape to close nested menus
- Home/End for first/last items

### Screen Reader Support
- Announce section headers
- Read full labels in collapsed mode
- Announce badge counts
- Indicate active state
- Provide context for nested items

## Deliverables
- [ ] Navigation menu component created
- [ ] Hierarchical menu support
- [ ] Active route highlighting
- [ ] Badge support implemented
- [ ] Collapsed mode working
- [ ] Section expand/collapse
- [ ] Permission filtering
- [ ] Theme variables applied
- [ ] Unit tests passing
- [ ] Accessibility compliant

## Next Steps
- Implement API Service (06.9)
- Create Theme Service (06.10)
- Build additional shared components (06.12)