<div class="projects-container">
  <div class="projects-header">
    <h1>{{ title }}</h1>
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="showCreateForm = !showCreateForm">
        <mat-icon>add</mat-icon>
        New Project
      </button>
      <button mat-icon-button (click)="loadProjects()" matTooltip="Refresh">
        <mat-icon>refresh</mat-icon>
      </button>
    </div>
  </div>

  <!-- Create Project Form -->
  <mat-card *ngIf="showCreateForm" class="create-form-card">
    <mat-card-header>
      <mat-card-title>Create New Project</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="createForm" (ngSubmit)="createProject()">
        <div class="form-grid">
          <mat-form-field>
            <mat-label>Project Name</mat-label>
            <input matInput formControlName="name" required>
            <mat-error *ngIf="createForm.get('name')?.hasError('required')">Name is required</mat-error>
            <mat-error *ngIf="createForm.get('name')?.hasError('minlength')">Name must be at least 3 characters</mat-error>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Project Path</mat-label>
            <input matInput formControlName="path" placeholder="/path/to/project" required>
            <mat-error>Path is required</mat-error>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Project Type</mat-label>
            <mat-select formControlName="type" required>
              <mat-option *ngFor="let type of projectTypes" [value]="type">
                <mat-icon>{{ getTypeIcon(type) }}</mat-icon>
                {{ type }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Language</mat-label>
            <input matInput formControlName="language" placeholder="e.g., TypeScript, Python">
          </mat-form-field>

          <mat-form-field>
            <mat-label>Framework</mat-label>
            <input matInput formControlName="framework" placeholder="e.g., Angular, React, Django">
          </mat-form-field>

          <mat-form-field class="full-width">
            <mat-label>Description</mat-label>
            <textarea matInput formControlName="description" rows="3"></textarea>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Build Command</mat-label>
            <input matInput formControlName="buildCommand" placeholder="e.g., npm run build">
          </mat-form-field>

          <mat-form-field>
            <mat-label>Test Command</mat-label>
            <input matInput formControlName="testCommand" placeholder="e.g., npm test">
          </mat-form-field>

          <mat-form-field>
            <mat-label>Start Command</mat-label>
            <input matInput formControlName="startCommand" placeholder="e.g., npm start">
          </mat-form-field>
        </div>

        <mat-card-actions align="end">
          <button mat-button type="button" (click)="showCreateForm = false">Cancel</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="!createForm.valid">
            Create Project
          </button>
        </mat-card-actions>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Projects Table -->
  <mat-card class="projects-table-card">
    <mat-card-content>
      @if (isLoading) {
        <lib-skeleton-loader type="table" [rows]="[1, 2, 3, 4, 5]" [columns]="[1, 2, 3, 4, 5, 6]"></lib-skeleton-loader>
      } @else {
        <div *ngIf="projects.length === 0" class="no-projects">
        <mat-icon>folder_off</mat-icon>
        <h3>No Projects Found</h3>
        <p>Create your first project to get started</p>
      </div>

      <table mat-table [dataSource]="projects" *ngIf="projects.length > 0">
        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Name</th>
          <td mat-cell *matCellDef="let project">
            <div class="project-name">
              <mat-icon>{{ getTypeIcon(project.type) }}</mat-icon>
              <div>
                <strong>{{ project.name }}</strong>
                <small>{{ project.path }}</small>
              </div>
            </div>
          </td>
        </ng-container>

        <!-- Type Column -->
        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef>Type</th>
          <td mat-cell *matCellDef="let project">
            <mat-chip>{{ project.type }}</mat-chip>
          </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let project">
            <mat-chip [color]="getStatusColor(project.status)" selected>
              {{ project.status }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Agents Column -->
        <ng-container matColumnDef="agents">
          <th mat-header-cell *matHeaderCellDef>Agents</th>
          <td mat-cell *matCellDef="let project">
            <span class="agent-count">{{ project.agents?.length || 0 }}</span>
          </td>
        </ng-container>

        <!-- Updated Column -->
        <ng-container matColumnDef="updated">
          <th mat-header-cell *matHeaderCellDef>Last Updated</th>
          <td mat-cell *matCellDef="let project">
            {{ project.updatedAt | date:'short' }}
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let project">
            <button mat-icon-button (click)="openProject(project)" matTooltip="Open">
              <mat-icon>open_in_new</mat-icon>
            </button>
            <button mat-icon-button (click)="editProject(project)" matTooltip="Edit">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button 
                    (click)="archiveProject(project)" 
                    *ngIf="project.status !== 'archived'"
                    matTooltip="Archive">
              <mat-icon>archive</mat-icon>
            </button>
            <button mat-icon-button (click)="deleteProject(project)" matTooltip="Delete">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
      }
    </mat-card-content>
  </mat-card>
</div>