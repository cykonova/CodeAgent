<div class="message" 
     [class.user]="message.role === 'user'" 
     [class.assistant]="message.role === 'assistant'">
  <div class="message-bubble">
    <mat-icon class="message-avatar">{{ getIcon() }}</mat-icon>
    <div class="message-content">
      <!-- Render tool calls using the new tool renderer system -->
      @if (message.toolCalls && message.toolCalls.length > 0) {
        <div class="tool-calls-section">
          @for (toolCall of message.toolCalls; track $index) {
            <app-tool-renderer [toolCall]="toolCall"></app-tool-renderer>
          }
        </div>
      }
      <!-- For messages without tool calls, parse and render as tool calls -->
      @else if (message.content && message.role === 'assistant') {
        <div class="tool-calls-section">
          @for (toolCall of getParsedToolCalls(); track $index) {
            <app-tool-renderer [toolCall]="toolCall"></app-tool-renderer>
          }
        </div>
      }
      <!-- User messages show as plain text -->
      @else if (message.content && message.role === 'user') {
        <div class="text-content">{{ message.content }}</div>
      }
    </div>
    @if (message.timestamp) {
      <div class="message-timestamp">{{ message.timestamp | date:'short' }}</div>
    }
  </div>
</div>