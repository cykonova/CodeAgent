<div class="tools-panel">
  <!-- Header -->
  <div class="tools-header">
    <div class="header-info">
      <h3>Available Tools</h3>
      <mat-chip class="tools-count">
        {{ getTotalEnabledToolsCount() }}/{{ getTotalToolsCount() }} enabled
      </mat-chip>
    </div>
    
    <button mat-icon-button (click)="refreshTools()" [disabled]="loading()" matTooltip="Refresh Tools">
      <mat-icon [class.spinning]="loading()">refresh</mat-icon>
    </button>
  </div>
  
  <mat-divider></mat-divider>
  
  <!-- Active Tools -->
  @if (activeTools().length > 0) {
    <div class="active-tools-section">
      <h4>
        <mat-icon>play_circle</mat-icon>
        Running Tools
        <mat-chip class="count-chip">{{ activeTools().length }}</mat-chip>
      </h4>
      
      <div class="active-tools-list">
        @for (toolId of activeTools(); track toolId) {
          @for (tool of tools(); track tool.id) {
            @if (tool.id === toolId) {
              <div class="active-tool">
                <mat-icon>{{ tool.icon }}</mat-icon>
                <span>{{ tool.name }}</span>
                <mat-progress-spinner diameter="16" mode="indeterminate"></mat-progress-spinner>
              </div>
            }
          }
        }
      </div>
      
      <mat-divider></mat-divider>
    </div>
  }
  
  <!-- Tool Categories -->
  <div class="tools-categories">
    <mat-accordion multi>
      @for (category of categories(); track category.name) {
        <mat-expansion-panel [expanded]="category.expanded">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-icon>{{ category.icon }}</mat-icon>
              <span>{{ category.name }}</span>
              
              @if (getRunningToolsCount(category) > 0) {
                <mat-chip class="running-chip">
                  {{ getRunningToolsCount(category) }} running
                </mat-chip>
              }
            </mat-panel-title>
            <mat-panel-description>
              {{ getEnabledToolsCount(category) }}/{{ category.tools.length }} enabled
            </mat-panel-description>
          </mat-expansion-panel-header>
          
          <div class="tools-list">
            @for (tool of category.tools; track tool.id) {
              <div class="tool-item" 
                   [class.disabled]="!tool.enabled"
                   [class.running]="tool.status === 'running'">
                
                <div class="tool-header" (click)="executeTool(tool)">
                  <div class="tool-info">
                    <mat-icon class="tool-icon">{{ tool.icon }}</mat-icon>
                    <div class="tool-details">
                      <span class="tool-name">{{ tool.name }}</span>
                      @if (tool.shortcut) {
                        <mat-chip class="shortcut-chip">{{ tool.shortcut }}</mat-chip>
                      }
                    </div>
                  </div>
                  
                  <div class="tool-actions">
                    @if (tool.status === 'running') {
                      <mat-progress-spinner diameter="20" mode="indeterminate"></mat-progress-spinner>
                    } @else {
                      <button mat-icon-button 
                              (click)="$event.stopPropagation(); executeTool(tool)"
                              [disabled]="!tool.enabled"
                              matTooltip="Execute tool">
                        <mat-icon>play_arrow</mat-icon>
                      </button>
                    }
                    
                    <button mat-icon-button 
                            (click)="$event.stopPropagation(); toggleTool(tool.id)"
                            [matTooltip]="tool.enabled ? 'Disable tool' : 'Enable tool'">
                      <mat-icon>{{ tool.enabled ? 'toggle_on' : 'toggle_off' }}</mat-icon>
                    </button>
                  </div>
                </div>
                
                <div class="tool-description">
                  {{ tool.description }}
                  @if (tool.lastUsed) {
                    <span class="last-used">â€¢ Last used {{ formatLastUsed(tool.lastUsed) }}</span>
                  }
                </div>
              </div>
            }
          </div>
        </mat-expansion-panel>
      }
    </mat-accordion>
  </div>
  
  <!-- Tool Settings -->
  <mat-divider></mat-divider>
  
  <div class="tools-footer">
    <div class="footer-stats">
      <span class="stat">
        <mat-icon>check_circle</mat-icon>
        {{ getTotalEnabledToolsCount() }} enabled
      </span>
      <span class="stat">
        <mat-icon>play_circle</mat-icon>
        {{ getActiveToolsCount() }} running
      </span>
    </div>
    
    <div class="footer-actions">
      <button mat-button (click)="toggleAllTools()">
        <mat-icon>select_all</mat-icon>
        Toggle All
      </button>
    </div>
  </div>
</div>