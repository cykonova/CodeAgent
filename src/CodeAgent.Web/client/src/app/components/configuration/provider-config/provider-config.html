<div class="provider-config">
  <div class="providers-layout">
    <app-panel 
      title="Configured Providers" 
      icon="dns"
      class="providers-list-panel">
      <div panel-actions>
        <button mat-icon-button color="primary" (click)="addNewProvider()" matTooltip="Add Provider">
          <mat-icon>add</mat-icon>
        </button>
      </div>
      
      <mat-nav-list>
        @for (provider of providers; track provider.id) {
          <app-list-item
            [title]="provider.name"
            [subtitle]="provider.type"
            [icon]="getProviderIcon(provider.type)"
            [selected]="selectedProvider()?.id === provider.id"
            (click)="selectProvider(provider)">
            <div class="provider-status">
              @if (provider.enabled) {
                <mat-icon class="status-icon enabled">check_circle</mat-icon>
              } @else {
                <mat-icon class="status-icon disabled">cancel</mat-icon>
              }
            </div>
          </app-list-item>
        }
      </mat-nav-list>
    </app-panel>
    
    <app-panel 
      title="Provider Details" 
      icon="settings"
      class="provider-details-panel">
      @if (selectedProvider()) {
        <div panel-actions>
          @if (!editingProvider()) {
            <button mat-button (click)="startEditing()">
              <mat-icon>edit</mat-icon>
              Edit
            </button>
          } @else {
            <button mat-button (click)="saveProvider()" color="primary">
              <mat-icon>save</mat-icon>
              Save
            </button>
            <button mat-button (click)="cancelEditing()">
              Cancel
            </button>
          }
          <button mat-button color="warn" (click)="deleteProvider()">
            <mat-icon>delete</mat-icon>
            Delete
          </button>
        </div>
        
        <form [formGroup]="form" class="provider-form">
          <app-form-field
            label="Provider Name"
            formControlName="name"
            [readonly]="!editingProvider()">
          </app-form-field>
          
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Provider Type</mat-label>
            <mat-select formControlName="type" [disabled]="!editingProvider()">
              <mat-option value="openai">
                <mat-icon>auto_awesome</mat-icon>
                OpenAI
              </mat-option>
              <mat-option value="claude">
                <mat-icon>psychology</mat-icon>
                Claude
              </mat-option>
              <mat-option value="ollama">
                <mat-icon>computer</mat-icon>
                Ollama
              </mat-option>
              <mat-option value="lmstudio">
                <mat-icon>desktop_windows</mat-icon>
                LM Studio
              </mat-option>
            </mat-select>
          </mat-form-field>
          
          @if (form.get('type')?.value === 'openai' || form.get('type')?.value === 'claude') {
            <app-form-field
              label="API Key"
              type="password"
              formControlName="apiKey"
              suffixIcon="key"
              [readonly]="!editingProvider()">
            </app-form-field>
          }
          
          @if (form.get('type')?.value === 'ollama' || form.get('type')?.value === 'lmstudio') {
            <app-form-field
              label="Base URL"
              formControlName="baseUrl"
              hint="API endpoint URL"
              [readonly]="!editingProvider()">
            </app-form-field>
          }
          
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Model</mat-label>
            @if (form.get('type')?.value === 'lmstudio' || editingProvider()) {
              <input matInput formControlName="model" [readonly]="!editingProvider()">
            } @else {
              <mat-select formControlName="model" [disabled]="!editingProvider()">
                @for (model of availableModels[form.get('type')?.value || 'openai']; track model) {
                  <mat-option [value]="model">{{ model }}</mat-option>
                }
              </mat-select>
            }
          </mat-form-field>
          
          <mat-slide-toggle formControlName="enabled" [disabled]="!editingProvider()">
            Provider Enabled
          </mat-slide-toggle>
          
          <div class="test-section">
            <button mat-raised-button (click)="testProvider()">
              <mat-icon>speed</mat-icon>
              Test Connection
            </button>
          </div>
        </form>
      } @else {
        <div class="no-selection">
          <mat-icon>touch_app</mat-icon>
          <p>Select a provider to view details</p>
        </div>
      }
    </app-panel>
  </div>
</div>