<mat-toolbar *ngIf="showLayout$ | async" color="primary" class="app-toolbar">
  <!-- Menu toggle button -->
  <button 
    mat-icon-button 
    (click)="toggleSidenav()"
    aria-label="Toggle navigation menu"
    class="menu-toggle">
    <mat-icon>menu</mat-icon>
  </button>
  
  <!-- Application title -->
  <span class="app-title">{{ title }}</span>
  
  <!-- Spacer to push items to the right -->
  <span class="toolbar-spacer"></span>
  
  <!-- Connection status indicator -->
  <div class="connection-status" [ngClass]="connectionClass$ | async">
    <mat-icon [class.connecting]="isConnecting$ | async">{{ connectionIcon$ | async }}</mat-icon>
    <span class="connection-text">{{ connectionText$ | async }}</span>
  </div>
  
  <!-- Notifications -->
  <button 
    mat-icon-button 
    [matMenuTriggerFor]="notificationsMenu"
    aria-label="Notifications">
    <mat-icon matBadge="3" matBadgeColor="accent">notifications</mat-icon>
  </button>
  
  <!-- Theme toggle -->
  <app-theme-toggle></app-theme-toggle>
  
  <!-- User menu -->
  <button 
    mat-icon-button 
    [matMenuTriggerFor]="userMenu"
    aria-label="User menu">
    <mat-icon>account_circle</mat-icon>
  </button>
  
  <!-- Settings -->
  <button 
    mat-icon-button 
    routerLink="/settings"
    aria-label="Settings">
    <mat-icon>settings</mat-icon>
  </button>
</mat-toolbar>

<!-- Notifications dropdown menu -->
<mat-menu #notificationsMenu="matMenu" class="notifications-menu">
  <div mat-menu-item disabled class="menu-header">
    <strong>Notifications</strong>
  </div>
  <button mat-menu-item>
    <mat-icon>info</mat-icon>
    <span>Agent completed successfully</span>
  </button>
  <button mat-menu-item>
    <mat-icon>warning</mat-icon>
    <span>Build failed in project X</span>
  </button>
  <button mat-menu-item>
    <mat-icon>check_circle</mat-icon>
    <span>Deployment completed</span>
  </button>
  <mat-divider></mat-divider>
  <button mat-menu-item routerLink="/notifications">
    <span>View all notifications</span>
  </button>
</mat-menu>

<!-- User dropdown menu -->
<mat-menu #userMenu="matMenu" class="user-menu">
  <div mat-menu-item disabled class="menu-header">
    <mat-icon>account_circle</mat-icon>
    <div class="user-info">
      <strong>User Name</strong>
      <small>user&#64;example.com</small>
    </div>
  </div>
  <mat-divider></mat-divider>
  <button mat-menu-item routerLink="/profile">
    <mat-icon>person</mat-icon>
    <span>Profile</span>
  </button>
  <button mat-menu-item routerLink="/settings">
    <mat-icon>settings</mat-icon>
    <span>Settings</span>
  </button>
  <mat-divider></mat-divider>
  <button mat-menu-item>
    <mat-icon>logout</mat-icon>
    <span>Sign out</span>
  </button>
</mat-menu>

<!-- Main layout container -->
<mat-sidenav-container class="sidenav-container" 
  [class.dark-theme]="isDarkTheme$ | async"
  [class.sidenav-collapsed]="isCollapsed && !isMobile"
  [class.no-sidenav]="!(showLayout$ | async)">
  <!-- Side navigation -->
  <mat-sidenav 
    *ngIf="showLayout$ | async"
    #sidenav
    [mode]="(sidenavMode$ | async) || 'side'"
    [opened]="(sidenavOpened$ | async) || false"
    [fixedInViewport]="false"
    class="app-sidenav"
    [class.mobile-sidenav]="isMobile"
    [class.tablet-sidenav]="isTablet"
    [class.collapsed]="isCollapsed">
    
    <!-- Navigation menu component -->
    <app-navigation-menu 
      [collapsed]="isCollapsed"
      (itemClick)="onNavItemClick()">
    </app-navigation-menu>
  </mat-sidenav>
  
  <!-- Main content area -->
  <mat-sidenav-content class="app-content">
    <div class="content-container" [class.mobile-padding]="isMobile">
      <router-outlet></router-outlet>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>